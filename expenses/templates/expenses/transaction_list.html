{% extends 'expenses/base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Транзакции</h2>
    <a href="{% url 'expenses:transaction_add' %}" class="btn btn-success">+ Добавить транзакцию</a>
</div>

<!-- ФИЛЬТРЫ В ВЫПАДАЮЩЕМ СПИСКЕ -->
<div class="dropdown mb-4">
    <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
        Фильтры
    </button>
    <div class="dropdown-menu p-4" style="min-width: 350px;">

        <form method="get">

            <div class="mb-3">
                <label class="form-label">Дата — от</label>
                <input type="date" name="date_from" class="form-control"
                       value="{{ request.GET.date_from }}">
            </div>

            <div class="mb-3">
                <label class="form-label">Дата — до</label>
                <input type="date" name="date_to" class="form-control"
                       value="{{ request.GET.date_to }}">
            </div>

            <div class="mb-3">
                <label class="form-label">Категория</label>
                <select name="category" class="form-select">
                    <option value="">Все</option>
                    {% for cat in categories %}
                        <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>
                            {{ cat.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Счет</label>
                <select name="account" class="form-select">
                    <option value="">Все</option>
                    {% for acc in accounts %}
                        <option value="{{ acc.id }}" {% if request.GET.account == acc.id|stringformat:"s" %}selected{% endif %}>
                            {{ acc.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Тип</label>
                <select name="type" class="form-select">
                    <option value="">Все</option>
                    <option value="income" {% if request.GET.type == "income" %}selected{% endif %}>Доход</option>
                    <option value="expense" {% if request.GET.type == "expense" %}selected{% endif %}>Расход</option>
                </select>
            </div>

            <div class="d-flex gap-2 mt-3">
                <button type="submit" class="btn btn-primary w-100">Применить</button>

                <!-- КНОПКА СБРОСА ФИЛЬТРОВ -->
                <a href="{% url 'expenses:transaction_list' %}" 
                   class="btn btn-secondary w-100">
                    Сбросить
                </a>
            </div>

        </form>

    </div>
</div>


<!-- ТАБЛИЦА -->
<table class="table table-striped">
    <thead>
        <tr>
            <th>Дата</th>
            <th>Счет</th>
            <th>Категория</th>
            <th>Сумма</th>
            <th>Тип</th>
            <th>Описание</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {% for transaction in transaction_list %}
        <tr>
            <td>{{ transaction.date|date:"d.m.Y" }}</td>
            <td>{{ transaction.account.name }}</td>
            <td>{{ transaction.category.name|default:"-" }}</td>
            <td>{{ transaction.amount }}</td>
            <td>
                {% if transaction.type == 'income' %}
                    <span class="badge bg-success">Доход</span>
                {% else %}
                    <span class="badge bg-danger">Расход</span>
                {% endif %}
            </td>
            <td>{{ transaction.description|default:"-" }}</td>
            <td>
                <a href="{% url 'expenses:transaction_edit' transaction.pk %}" class="btn btn-sm btn-primary">Редактировать</a>
                <a href="{% url 'expenses:transaction_delete' transaction.pk %}" class="btn btn-sm btn-danger">Удалить</a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="7" class="text-center">Нет транзакций</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
