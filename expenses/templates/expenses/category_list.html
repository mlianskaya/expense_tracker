{% extends 'expenses/base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h2>
    <a href="{% url 'expenses:category_add' %}" class="btn btn-success">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</a>
</div>

<div class="row">
    {% for category in object_list %}
    <div class="col-md-4 mb-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">{{ category.name }}</h5>
                <p class="card-text">
                    –†–æ–¥–∏—Ç–µ–ª—å: {{ category.parent.name|default:"-" }}
                </p>

                <!-- –ü–†–û–°–¢–û–ô –ë–Æ–î–ñ–ï–¢ –ë–ï–ó –§–ò–õ–¨–¢–†–û–í -->
                <div class="budget-info mb-3 p-3 bg-light rounded">
                    {% for budget in category.budgets.all|slice:"1" %}
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-info fs-6">
                                {{ budget.spent_amount }} / {{ budget.limit_amount }}
                            </span>
                            {% if budget.is_over_limit %}
                                <span class="badge bg-danger">üö® –ø—Ä–µ–≤—ã—à–µ–Ω</span>
                            {% endif %}
                        </div>
                        <small class="text-muted d-block mb-2">
                            –û—Å—Ç–∞–ª–æ—Å—å: {{ budget.remaining_amount }}
                        </small>
                        <div class="progress mb-2" style="height: 6px;">
                            <div class="progress-bar" role="progressbar"
                                 style="width: {{ budget.progress_percent }}%"
                                 aria-valuenow="{{ budget.progress_percent }}"
                                 aria-valuemin="0" aria-valuemax="100">
                            </div>
                        </div>
                        <div class="d-flex gap-2">
                            <a href="{% url 'expenses:budget_edit' budget.pk %}" class="btn btn-sm btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å</a>
                        </div>
                    {% empty %}
                        <small class="text-muted">–Ω–µ—Ç –±—é–¥–∂–µ—Ç–∞</small>
                        <a href="{% url 'expenses:budget_add' %}?category={{ category.pk }}" class="btn btn-sm btn-outline-primary mt-2">üìä –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</a>
                    {% endfor %}
                </div>



                <div class="d-flex gap-2">
                    <a href="{% url 'expenses:category_edit' category.pk %}"
                       class="btn btn-sm btn-primary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                    <a href="{% url 'expenses:category_delete' category.pk %}"
                       class="btn btn-sm btn-danger">–£–¥–∞–ª–∏—Ç—å</a>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π.
            <a href="{% url 'expenses:category_add' %}">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</a>
        </div>
    </div>
{% endfor %}
</div>
{% endblock %}
